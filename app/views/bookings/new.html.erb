<%# app/views/bookings/new.html.erb %>

<div class="container mt-5">
  <!-- Titre et description -->
  <div class="text-center mb-4">
    <h1 class="display-5">Réservation</h1>
    <p class="text-muted">Complétez le formulaire pour réserver votre forfait.</p>
  </div>

  <!-- Formulaire de réservation -->
  <div class="card shadow-lg p-4">
    <div class="card-body">
      <%= simple_form_for @booking, url: photobooth_package_bookings_path(@photobooth, @package), method: :post do |f| %>
        <div class="mb-3">
          <%= f.input :address, label: "Adresse de l'événement", placeholder: "Entrez l'adresse", input_html: { class: "form-control" } %>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <%= f.input :date, label: "Date de l'événement", as: :date, input_html: { class: "form-control" } %>
          </div>
          <div class="col-md-6">
            <%= f.input :time, label: "Heure de l'événement", as: :time, input_html: { class: "form-control" } %>
          </div>
        </div>

        <%= f.input :package_id, as: :hidden, value: @package.id %>

        <div class="text-center mt-4">
          <%= f.submit "Réserver ce forfait", class: "btn btn-primary btn-lg px-5" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Lien retour -->
  <div class="text-center mt-3">
    <%= link_to 'Retour', photobooth_path(@photobooth), class: "btn btn-secondary" %>
  </div>

  <!-- Section de paiement -->
  <div class="card shadow-lg mt-5">
    <div class="card-body">
      <h2 class="text-center">Finalisez votre réservation</h2>
      <p class="text-center"><strong>Package:</strong> <%= @package.photobooth.name %></p>
      <p class="text-center"><strong>Prix:</strong> <%= humanized_money_with_symbol(@package.price) %></p>

      <!-- Formulaire de paiement Stripe -->
      <form action="/payments/create" method="post" class="d-flex justify-content-center">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <input type="hidden" name="package_id" value="<%= @package.id %>">

        <script
          src="https://checkout.stripe.com/checkout.js" class="stripe-button"
          data-key="<%= @stripe_publishable_key %>"
          data-amount="<%= @package.price_cents %>"
          data-name="Réservation Photobooth"
          data-description="<%= @package.photobooth.name %>"
          data-currency="eur"
          data-locale="auto">
        </script>
      </form>
    </div>
  </div>
</div>

